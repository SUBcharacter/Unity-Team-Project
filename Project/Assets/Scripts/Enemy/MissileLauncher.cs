using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class MissileLauncher : MonoBehaviour
{
    [SerializeField] Scanner scanner;                    // 타겟 감지용 스캐너
    [SerializeField] GameObject bulletPrefab;            // 프리팹으로 만든 미사일
    [SerializeField] Transform firePoint;                // 발사 위치
    [SerializeField] float fireDelay = 1.5f;             // 발사 주기

    private Coroutine fireCoroutine;

    bool Isfiring = false;


    void Update()
    {
        Transform target = scanner.nearestTarget;
        if (target != null && !Isfiring)
        {
            fireCoroutine = StartCoroutine(FireCouroutine());
            Isfiring = true;
        }
    }

    void Fire(Transform target)
    {
        Debug.Log("현재 타겟 이름: " + target.name);
        Debug.Log("타겟 위치: " + target.position);
        Debug.Log("발사 위치: " + firePoint.position);

        GameObject bullet = Instantiate(bulletPrefab, firePoint.position, Quaternion.identity);
        bullet.transform.position = firePoint.position;
        BulletShooter shooter = bullet.GetComponent<BulletShooter>();
        if (shooter != null)
        {
            shooter.SetTarget(target);
        }
    }

    IEnumerator FireCouroutine()
    {
        while (true)
        {
            Transform target = scanner.nearestTarget;
            if (target != null)
            {

                Debug.Log(" 타겟 감지됨: " + target.name + " / 위치: " + target.position);
                Fire(target);
            }
            yield return new WaitForSeconds(fireDelay);
        }
    }
}
